<?xml version="1.0"?>

<robot  name="thor_arm_7dof" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!--<xacro:include filename="$(find thor_mang_description)/urdf/joint_params.xacro" />-->
  
  <!--Indices starting at 0 from pelvis -->
  <property name="torso_joint_0_name" value="waist_pan" />
  <property name="torso_joint_1_name" value="waist_tilt" />  
  
  <!--Note pelvis origin is 7.92 cm below COM-->
  <macro name="thor_mang_torso_macro">
  
  <link
    name="pelvis">
    <inertial>
                <origin xyz="-33.34e-03 -0.03e-03 -6.9e-03" rpy="0 0 0"/>
                <mass value="7117e-03"/>
                <inertia ixx="32912132.59e-09" ixy="-6550.476e-09" ixz="-625100.233e-09" iyy="26051670.225e-09" iyz="8854.993e-09" izz="36052882.861e-09" />
    </inertial>
    <xacro:pelvis_visual_geom_macro />
    <xacro:pelvis_collision_geom_macro />
  </link>
  
  <joint
    name="${torso_joint_0_name}"
    type="revolute">
    <origin
      xyz="0.0 0 0.137"
      rpy="0 0 0"
       />
    <!--rpy="0.000329950722368627 -3.91151844547536E-19 1.16573417585641E-15"-->
    <parent
      link="pelvis" />
    <child
      link="waist" />
    <axis
      xyz="0 0 1" />
    <xacro:joint_medium_servo_limits_macro lower="${-1.8}" upper="${1.3}"/>
  </joint>
  
  <link
    name="waist">
    <inertial>
                <origin xyz="0 0.93e-03 -10.84e-03" rpy="0 0 0"/>
                <mass value="1298e-03"/>
                <inertia ixx="2374018.226e-09" ixy="4.781e-09" ixz="78.16e-09" iyy="1025281.476e-09" iyz="23194.288e-09" izz="2214853.704e-09" />
    </inertial>
    <xacro:waist_visual_geom_macro />
    <xacro:waist_collision_geom_macro />
  </link>
  
  <joint
    name="${torso_joint_1_name}"
    type="revolute">
    <origin
      xyz="0 0 0.0"
      rpy="0 0 0"
       />
    <!--rpy="0.000329950722368627 -3.91151844547536E-19 1.16573417585641E-15"-->
    <parent
      link="waist" />
    <child
      link="utorso" />
    <axis
      xyz="0 1 0" />
    <xacro:joint_large_servo_limits_macro lower="${-0.05}" upper="${1.07}"/>
  </joint>
  
    <link
    name="utorso">
    <inertial>
                <origin xyz="-68.33e-03 -0.08e-03 119.43e-03" rpy="0 0 0"/>
                <mass value="12164e-03"/>
                <inertia ixx="161010220.938e-09" ixy="-73707.619e-09" ixz="4891620.396e-09" iyy="98136402.342e-09" iyz="673600.835e-09" izz="176899493.541e-09" />
    </inertial>
    <xacro:utorso_visual_geom_macro />
    <xacro:utorso_collision_geom_macro />
  </link>
  
  <!--Transmissions for gazebo ros control-->
  <xacro:joint_transmission_macro joint_name="${torso_joint_0_name}"/>
  <xacro:joint_transmission_macro joint_name="${torso_joint_1_name}"/>
  
  <!--Coloring for Gazebo-->
  <xacro:set_gazebo_robot_default_color_macro link_name="pelvis" />
  <xacro:set_gazebo_robot_default_color_macro link_name="waist" />
  <xacro:set_gazebo_robot_default_color_macro link_name="utorso" />
  
  <gazebo>
    <plugin name="pelvis_imu_controller" filename="libhector_gazebo_ros_imu.so">
      <alwaysOn>true</alwaysOn>
      <updateRate>125.0</updateRate>
      <bodyName>pelvis</bodyName>
      <topicName>/thor_mang/pelvis_imu</topicName>
      <accelDrift>0.0 0.0 0.0</accelDrift>
      <accelGaussianNoise>0.1 0.1 0.1</accelGaussianNoise>
      <rateDrift>0.0 0.0 0.0</rateDrift>
      <rateGaussianNoise>0.05 0.05 0.05</rateGaussianNoise>
      <headingDrift>0.0</headingDrift>
      <headingGaussianNoise>0.05</headingGaussianNoise>
    </plugin>
  </gazebo>
  
  </macro>
</robot>

